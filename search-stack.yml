version: '3.2'

services:
  opensearch:
    image: opensearchproject/opensearch:3
    environment:
      #USERNAME: admin 
      OPENSEARCH_INITIAL_ADMIN_PASSWORD: OpensearchPassword@1234
      discovery.type: single-node
      plugins.security.disabled: "true"
      # DISABLE_SECURITY_PLUGIN: "true" # Disables Security plugin
    ports:
      - "9200:9200"
      - "9600:9600"
    volumes:
      - es_data:/usr/share/opensearch/data
    deploy:
      mode: replicated
      replicas: 1
      placement:
        # This constraint ensures the PostgreSQL service is deployed to a manager node
        # as it is a single-replica service and requires stable storage.
        constraints:
          - node.role == manager

  opensearch_dashboards:
    image: opensearchproject/opensearch-dashboards:3
    environment:
      - 'OPENSEARCH_HOSTS=["http://opensearch:9200"]'
      - "DISABLE_SECURITY_DASHBOARDS_PLUGIN=true"
    ports:
      - "5601:5601"
    depends_on:
      - opensearch
    deploy:
      mode: replicated
      replicas: 1
      placement:
        # This constraint ensures the PostgreSQL service is deployed to a manager node
        # as it is a single-replica service and requires stable storage.
        constraints:
          - node.role == manager

networks:
  agent_network:
    driver: overlay
    attachable: true

volumes:
  es_data: