// @editorjs/image@2.10.0 downloaded from https://ga.jspm.io/npm:@editorjs/image@2.10.0/dist/image.mjs

(function(){try{if(typeof document<"u"){var o=document.createElement("style");o.appendChild(document.createTextNode('.image-tool{--bg-color: #cdd1e0;--front-color: #388ae5;--border-color: #e8e8eb}.image-tool__image{border-radius:3px;overflow:hidden;margin-bottom:10px}.image-tool__image-picture{max-width:100%;vertical-align:bottom;display:block}.image-tool__image-preloader{width:50px;height:50px;border-radius:50%;background-size:cover;margin:auto;position:relative;background-color:var(--bg-color);background-position:center center}.image-tool__image-preloader:after{content:"";position:absolute;z-index:3;width:60px;height:60px;border-radius:50%;border:2px solid var(--bg-color);border-top-color:var(--front-color);left:50%;top:50%;margin-top:-30px;margin-left:-30px;animation:image-preloader-spin 2s infinite linear;box-sizing:border-box}.image-tool__caption{display:none}.image-tool__caption[contentEditable=true][data-placeholder]:before{position:absolute!important;content:attr(data-placeholder);color:#707684;font-weight:400;display:none}.image-tool__caption[contentEditable=true][data-placeholder]:empty:before{display:block}.image-tool__caption[contentEditable=true][data-placeholder]:empty:focus:before{display:none}.image-tool--empty .image-tool__image,.image-tool--empty .image-tool__caption,.image-tool--loading .image-tool__caption{display:none}.image-tool .cdx-button{display:flex;align-items:center;justify-content:center}.image-tool .cdx-button svg{height:auto;margin:0 6px 0 0}.image-tool--filled .cdx-button,.image-tool--filled .image-tool__image-preloader{display:none}.image-tool--loading .image-tool__image{min-height:200px;display:flex;border:1px solid var(--border-color);background-color:#fff}.image-tool--loading .image-tool__image-picture,.image-tool--loading .cdx-button{display:none}.image-tool--withBorder .image-tool__image{border:1px solid var(--border-color)}.image-tool--withBackground .image-tool__image{padding:15px;background:var(--bg-color)}.image-tool--withBackground .image-tool__image-picture{max-width:60%;margin:0 auto}.image-tool--stretched .image-tool__image-picture{width:100%}.image-tool--caption .image-tool__caption{display:block}@keyframes image-preloader-spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}')),document.head.appendChild(o)}}catch(o){console.error("vite-plugin-css-injected-by-js",o)}})();const o='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19V19C9.13623 19 8.20435 19 7.46927 18.6955C6.48915 18.2895 5.71046 17.5108 5.30448 16.5307C5 15.7956 5 14.8638 5 13V12C5 9.19108 5 7.78661 5.67412 6.77772C5.96596 6.34096 6.34096 5.96596 6.77772 5.67412C7.78661 5 9.19108 5 12 5H13.5C14.8956 5 15.5933 5 16.1611 5.17224C17.4395 5.56004 18.44 6.56046 18.8278 7.83886C19 8.40666 19 9.10444 19 10.5V10.5"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M16 13V16M16 19V16M19 16H16M16 16H13"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6.5 17.5L17.5 6.5"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.9919 10.5H19.0015"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.9919 19H11.0015"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13L13 5"/></svg>',i='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.9919 9.5H19.0015"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.5 5H14.5096"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M14.625 5H15C17.2091 5 19 6.79086 19 9V9.375"/><path stroke="currentColor" stroke-width="2" d="M9.375 5L9 5C6.79086 5 5 6.79086 5 9V9.375"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.3725 5H9.38207"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 9.5H5.00957"/><path stroke="currentColor" stroke-width="2" d="M9.375 19H9C6.79086 19 5 17.2091 5 15V14.625"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.3725 19H9.38207"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 14.55H5.00957"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M16 13V16M16 19V16M19 16H16M16 16H13"/></svg>',s='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><rect width="14" height="14" x="5" y="5" stroke="currentColor" stroke-width="2" rx="4"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.13968 15.32L8.69058 11.5661C9.02934 11.2036 9.48873 11 9.96774 11C10.4467 11 10.9061 11.2036 11.2449 11.5661L15.3871 16M13.5806 14.0664L15.0132 12.533C15.3519 12.1705 15.8113 11.9668 16.2903 11.9668C16.7693 11.9668 17.2287 12.1705 17.5675 12.533L18.841 13.9634"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.7778 9.33331H13.7867"/></svg>',u='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9L20 12L17 15"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 12H20"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 9L4 12L7 15"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12H10"/></svg>',k='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M8 9V7.2C8 7.08954 8.08954 7 8.2 7L12 7M16 9V7.2C16 7.08954 15.9105 7 15.8 7L12 7M12 7L12 17M12 17H10M12 17H14"/></svg>';function M(o,i=null,s={}){const u=document.createElement(o);Array.isArray(i)?u.classList.add(...i):i!==null&&u.classList.add(i);for(const o in s)s.hasOwnProperty(o)&&(u[o]=s[o]);return u}var _=(o=>(o.Empty="empty",o.Uploading="uploading",o.Filled="filled",o))(_||{});class U{
/**
   * @param ui - image tool Ui module
   * @param ui.api - Editor.js API
   * @param ui.config - user config
   * @param ui.onSelectFile - callback for clicks on Select file button
   * @param ui.readOnly - read-only mode flag
   */
constructor({api:o,config:i,onSelectFile:s,readOnly:u}){this.api=o,this.config=i,this.onSelectFile=s,this.readOnly=u,this.nodes={wrapper:M("div",[this.CSS.baseClass,this.CSS.wrapper]),imageContainer:M("div",[this.CSS.imageContainer]),fileButton:this.createFileButton(),imageEl:void 0,imagePreloader:M("div",this.CSS.imagePreloader),caption:M("div",[this.CSS.input,this.CSS.caption],{contentEditable:!this.readOnly})},this.nodes.caption.dataset.placeholder=this.config.captionPlaceholder,this.nodes.imageContainer.appendChild(this.nodes.imagePreloader),this.nodes.wrapper.appendChild(this.nodes.imageContainer),this.nodes.wrapper.appendChild(this.nodes.caption),this.nodes.wrapper.appendChild(this.nodes.fileButton)
/**
   * Apply visual representation of activated tune
   * @param tuneName - one of available tunes {@link Tunes.tunes}
   * @param status - true for enable, false for disable
   */}applyTune(o,i){this.nodes.wrapper.classList.toggle(`${this.CSS.wrapper}--${o}`,i)}
/**
   * Renders tool UI
   * @param toolData - saved tool data
   */render(o){return o.file===void 0||Object.keys(o.file).length===0?this.toggleStatus("empty"):this.toggleStatus("uploading"),this.nodes.wrapper
/**
   * Shows uploading preloader
   * @param src - preview source
   */}showPreloader(o){this.nodes.imagePreloader.style.backgroundImage=`url(${o})`,this.toggleStatus("uploading")}hidePreloader(){this.nodes.imagePreloader.style.backgroundImage="",this.toggleStatus("empty")
/**
   * Shows an image
   * @param url - image source
   */}fillImage(o){const i=/\.mp4$/.test(o)?"VIDEO":"IMG",s={src:o};let u="load";i==="VIDEO"&&(s.autoplay=!0,s.loop=!0,s.muted=!0,s.playsinline=!0,u="loadeddata"),this.nodes.imageEl=M(i,this.CSS.imageEl,s),this.nodes.imageEl.addEventListener(u,(()=>{this.toggleStatus("filled"),this.nodes.imagePreloader!==void 0&&(this.nodes.imagePreloader.style.backgroundImage="")})),this.nodes.imageContainer.appendChild(this.nodes.imageEl)
/**
   * Shows caption input
   * @param text - caption content text
   */}fillCaption(o){this.nodes.caption!==void 0&&(this.nodes.caption.innerHTML=o)}get CSS(){return{baseClass:this.api.styles.block,loading:this.api.styles.loader,input:this.api.styles.input,button:this.api.styles.button,wrapper:"image-tool",imageContainer:"image-tool__image",imagePreloader:"image-tool__image-preloader",imageEl:"image-tool__image-picture",caption:"image-tool__caption"}}createFileButton(){const o=M("div",[this.CSS.button]);return o.innerHTML=this.config.buttonContent??`${s} ${this.api.i18n.t("Select an Image")}`,o.addEventListener("click",(()=>{this.onSelectFile()})),o
/**
   * Changes UI status
   * @param status - see {@link Ui.status} constants
   */}toggleStatus(o){for(const i in _)Object.prototype.hasOwnProperty.call(_,i)&&this.nodes.wrapper.classList.toggle(`${this.CSS.wrapper}--${_[i]}`,o===_[i])}}function D(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var C={exports:{}};(function(o,i){(function(i,s){o.exports=s()})(window,(function(){return function(o){var i={};function r(s){if(i[s])return i[s].exports;var u=i[s]={i:s,l:!1,exports:{}};return o[s].call(u.exports,u,u.exports,r),u.l=!0,u.exports}return r.m=o,r.c=i,r.d=function(o,i,s){r.o(o,i)||Object.defineProperty(o,i,{enumerable:!0,get:s})},r.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},r.t=function(o,i){if(1&i&&(o=r(o)),8&i||4&i&&typeof o=="object"&&o&&o.__esModule)return o;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:o}),2&i&&typeof o!="string")for(var u in o)r.d(s,u,function(i){return o[i]}.bind(null,u));return s},r.n=function(o){var i=o&&o.__esModule?function(){return o.default}:function(){return o};return r.d(i,"a",i),i},r.o=function(o,i){return Object.prototype.hasOwnProperty.call(o,i)},r.p="",r(r.s=3)}([function(o,i){var s;s=function(){return this}();try{s=s||new Function("return this")()}catch{typeof window=="object"&&(s=window)}o.exports=s},function(o,i,s){(function(o){var u=s(2),k=setTimeout;function v(){}function l(o){if(!(this instanceof l))throw new TypeError("Promises must be constructed via new");if(typeof o!="function")throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],t(o,this)}function f(o,i){for(;o._state===3;)o=o._value;o._state!==0?(o._handled=!0,l._immediateFn((function(){var s=o._state===1?i.onFulfilled:i.onRejected;if(s!==null){var u;try{u=s(o._value)}catch(o){return void y(i.promise,o)}p(i.promise,u)}else(o._state===1?p:y)(i.promise,o._value)}))):o._deferreds.push(i)}function p(o,i){try{if(i===o)throw new TypeError("A promise cannot be resolved with itself.");if(i&&(typeof i=="object"||typeof i=="function")){var s=i.then;if(i instanceof l)return o._state=3,o._value=i,void w(o);if(typeof s=="function")return void t((u=s,k=i,function(){u.apply(k,arguments)}),o)}o._state=1,o._value=i,w(o)}catch(i){y(o,i)}var u,k}function y(o,i){o._state=2,o._value=i,w(o)}function w(o){o._state===2&&o._deferreds.length===0&&l._immediateFn((function(){o._handled||l._unhandledRejectionFn(o._value)}));for(var i=0,s=o._deferreds.length;i<s;i++)f(o,o._deferreds[i]);o._deferreds=null}function b(o,i,s){this.onFulfilled=typeof o=="function"?o:null,this.onRejected=typeof i=="function"?i:null,this.promise=s}function t(o,i){var s=!1;try{o((function(o){s||(s=!0,p(i,o))}),(function(o){s||(s=!0,y(i,o))}))}catch(o){if(s)return;s=!0,y(i,o)}}l.prototype.catch=function(o){return this.then(null,o)},l.prototype.then=function(o,i){var s=new this.constructor(v);return f(this,new b(o,i,s)),s},l.prototype.finally=u.a,l.all=function(o){return new l((function(i,s){if(!o||o.length===void 0)throw new TypeError("Promise.all accepts an array");var u=Array.prototype.slice.call(o);if(u.length===0)return i([]);var k=u.length;function h(o,_){try{if(_&&(typeof _=="object"||typeof _=="function")){var C=_.then;if(typeof C=="function")return void C.call(_,(function(i){h(o,i)}),s)}u[o]=_,--k==0&&i(u)}catch(o){s(o)}}for(var _=0;_<u.length;_++)h(_,u[_])}))},l.resolve=function(o){return o&&typeof o=="object"&&o.constructor===l?o:new l((function(i){i(o)}))},l.reject=function(o){return new l((function(i,s){s(o)}))},l.race=function(o){return new l((function(i,s){for(var u=0,k=o.length;u<k;u++)o[u].then(i,s)}))},l._immediateFn=typeof o=="function"&&function(i){o(i)}||function(o){k(o,0)},l._unhandledRejectionFn=function(o){typeof console<"u"&&console&&console.warn("Possible Unhandled Promise Rejection:",o)},i.a=l}).call(this,s(5).setImmediate)},function(o,i,s){i.a=function(o){var i=this.constructor;return this.then((function(s){return i.resolve(o()).then((function(){return s}))}),(function(s){return i.resolve(o()).then((function(){return i.reject(s)}))}))}},function(o,i,s){function e(o){return(e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(o)}s(4);var u,k,_,C,E,T,j,S=s(8),F=(k=function(o){return new Promise((function(i,s){o=C(o),(o=E(o)).beforeSend&&o.beforeSend();var u=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");u.open(o.method,o.url),u.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(o.headers).forEach((function(i){var s=o.headers[i];u.setRequestHeader(i,s)}));var k=o.ratio;u.upload.addEventListener("progress",(function(i){var s=Math.round(i.loaded/i.total*100),u=Math.ceil(s*k/100);o.progress(Math.min(u,100))}),!1),u.addEventListener("progress",(function(i){var s=Math.round(i.loaded/i.total*100),u=Math.ceil(s*(100-k)/100)+k;o.progress(Math.min(u,100))}),!1),u.onreadystatechange=function(){if(u.readyState===4){var o=u.response;try{o=JSON.parse(o)}catch{}var k=S.parseHeaders(u.getAllResponseHeaders()),_={body:o,code:u.status,headers:k};j(u.status)?i(_):s(_)}},u.send(o.data)}))},_=function(o){return o.method="POST",k(o)},C=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(o.url&&typeof o.url!="string")throw new Error("Url must be a string");if(o.url=o.url||"",o.method&&typeof o.method!="string")throw new Error("`method` must be a string or null");if(o.method=o.method?o.method.toUpperCase():"GET",o.headers&&e(o.headers)!=="object")throw new Error("`headers` must be an object or null");if(o.headers=o.headers||{},o.type&&(typeof o.type!="string"||!Object.values(u).includes(o.type)))throw new Error("`type` must be taken from module's «contentType» library");if(o.progress&&typeof o.progress!="function")throw new Error("`progress` must be a function or null");if(o.progress=o.progress||function(o){},o.beforeSend=o.beforeSend||function(o){},o.ratio&&typeof o.ratio!="number")throw new Error("`ratio` must be a number");if(o.ratio<0||o.ratio>100)throw new Error("`ratio` must be in a 0-100 interval");if(o.ratio=o.ratio||90,o.accept&&typeof o.accept!="string")throw new Error("`accept` must be a string with a list of allowed mime-types");if(o.accept=o.accept||"*/*",o.multiple&&typeof o.multiple!="boolean")throw new Error("`multiple` must be a true or false");if(o.multiple=o.multiple||!1,o.fieldName&&typeof o.fieldName!="string")throw new Error("`fieldName` must be a string");return o.fieldName=o.fieldName||"files",o},E=function(o){switch(o.method){case"GET":var i=T(o.data,u.URLENCODED);delete o.data,o.url=/\?/.test(o.url)?o.url+"&"+i:o.url+"?"+i;break;case"POST":case"PUT":case"DELETE":case"UPDATE":var s=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).type||u.JSON}(o);(S.isFormData(o.data)||S.isFormElement(o.data))&&(s=u.FORM),o.data=T(o.data,s),s!==F.contentType.FORM&&(o.headers["content-type"]=s)}return o},T=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};switch(arguments.length>1?arguments[1]:void 0){case u.URLENCODED:return S.urlEncode(o);case u.JSON:return S.jsonEncode(o);case u.FORM:return S.formEncode(o);default:return o}},j=function(o){return o>=200&&o<300},{contentType:u={URLENCODED:"application/x-www-form-urlencoded; charset=utf-8",FORM:"multipart/form-data",JSON:"application/json; charset=utf-8"},request:k,get:function(o){return o.method="GET",k(o)},post:_,transport:function(o){return o=C(o),S.selectFiles(o).then((function(i){for(var s=new FormData,u=0;u<i.length;u++)s.append(o.fieldName,i[u],i[u].name);S.isObject(o.data)&&Object.keys(o.data).forEach((function(i){var u=o.data[i];s.append(i,u)}));var k=o.beforeSend;return o.beforeSend=function(){return k(i)},o.data=s,_(o)}))},selectFiles:function(o){return delete(o=C(o)).beforeSend,S.selectFiles(o)}});o.exports=F},function(o,i,s){s.r(i);var u=s(1);window.Promise=window.Promise||u.a},function(o,i,s){(function(o){var u=o!==void 0&&o||typeof self<"u"&&self||window,k=Function.prototype.apply;function v(o,i){this._id=o,this._clearFn=i}i.setTimeout=function(){return new v(k.call(setTimeout,u,arguments),clearTimeout)},i.setInterval=function(){return new v(k.call(setInterval,u,arguments),clearInterval)},i.clearTimeout=i.clearInterval=function(o){o&&o.close()},v.prototype.unref=v.prototype.ref=function(){},v.prototype.close=function(){this._clearFn.call(u,this._id)},i.enroll=function(o,i){clearTimeout(o._idleTimeoutId),o._idleTimeout=i},i.unenroll=function(o){clearTimeout(o._idleTimeoutId),o._idleTimeout=-1},i._unrefActive=i.active=function(o){clearTimeout(o._idleTimeoutId);var i=o._idleTimeout;i>=0&&(o._idleTimeoutId=setTimeout((function(){o._onTimeout&&o._onTimeout()}),i))},s(6),i.setImmediate=typeof self<"u"&&self.setImmediate||o!==void 0&&o.setImmediate||this&&this.setImmediate,i.clearImmediate=typeof self<"u"&&self.clearImmediate||o!==void 0&&o.clearImmediate||this&&this.clearImmediate}).call(this,s(0))},function(o,i,s){(function(o,i){(function(o,s){if(!o.setImmediate){var u,k,_,C,E,T=1,j={},S=!1,F=o.document,x=Object.getPrototypeOf&&Object.getPrototypeOf(o);x=x&&x.setTimeout?x:o,{}.toString.call(o.process)==="[object process]"?u=function(o){i.nextTick((function(){m(o)}))}:function(){if(o.postMessage&&!o.importScripts){var i=!0,s=o.onmessage;return o.onmessage=function(){i=!1},o.postMessage("","*"),o.onmessage=s,i}}()?(C="setImmediate$"+Math.random()+"$",E=function(i){i.source===o&&typeof i.data=="string"&&i.data.indexOf(C)===0&&m(+i.data.slice(C.length))},o.addEventListener?o.addEventListener("message",E,!1):o.attachEvent("onmessage",E),u=function(i){o.postMessage(C+i,"*")}):o.MessageChannel?((_=new MessageChannel).port1.onmessage=function(o){m(o.data)},u=function(o){_.port2.postMessage(o)}):F&&"onreadystatechange"in F.createElement("script")?(k=F.documentElement,u=function(o){var i=F.createElement("script");i.onreadystatechange=function(){m(o),i.onreadystatechange=null,k.removeChild(i),i=null},k.appendChild(i)}):u=function(o){setTimeout(m,0,o)},x.setImmediate=function(o){typeof o!="function"&&(o=new Function(""+o));for(var i=new Array(arguments.length-1),s=0;s<i.length;s++)i[s]=arguments[s+1];var k={callback:o,args:i};return j[T]=k,u(T),T++},x.clearImmediate=g}function g(o){delete j[o]}function m(o){if(S)setTimeout(m,0,o);else{var i=j[o];if(i){S=!0;try{(function(o){var i=o.callback,u=o.args;switch(u.length){case 0:i();break;case 1:i(u[0]);break;case 2:i(u[0],u[1]);break;case 3:i(u[0],u[1],u[2]);break;default:i.apply(s,u)}})(i)}finally{g(o),S=!1}}}}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,s(0),s(7))},function(o,i){var s,u,k=o.exports={};function d(){throw new Error("setTimeout has not been defined")}function v(){throw new Error("clearTimeout has not been defined")}function l(o){if(s===setTimeout)return setTimeout(o,0);if((s===d||!s)&&setTimeout)return s=setTimeout,setTimeout(o,0);try{return s(o,0)}catch{try{return s.call(null,o,0)}catch{return s.call(this,o,0)}}}(function(){try{s=typeof setTimeout=="function"?setTimeout:d}catch{s=d}try{u=typeof clearTimeout=="function"?clearTimeout:v}catch{u=v}})();var _,C=[],E=!1,T=-1;function b(){E&&_&&(E=!1,_.length?C=_.concat(C):T=-1,C.length&&t())}function t(){if(!E){var o=l(b);E=!0;for(var i=C.length;i;){for(_=C,C=[];++T<i;)_&&_[T].run();T=-1,i=C.length}_=null,E=!1,function(o){if(u===clearTimeout)return clearTimeout(o);if((u===v||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(o);try{u(o)}catch{try{return u.call(null,o)}catch{return u.call(this,o)}}}(o)}}function n(o,i){this.fun=o,this.array=i}function c(){}k.nextTick=function(o){var i=new Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)i[s-1]=arguments[s];C.push(new n(o,i)),C.length!==1||E||l(t)},n.prototype.run=function(){this.fun.apply(null,this.array)},k.title="browser",k.browser=!0,k.env={},k.argv=[],k.version="",k.versions={},k.on=c,k.addListener=c,k.once=c,k.off=c,k.removeListener=c,k.removeAllListeners=c,k.emit=c,k.prependListener=c,k.prependOnceListener=c,k.listeners=function(o){return[]},k.binding=function(o){throw new Error("process.binding is not supported")},k.cwd=function(){return"/"},k.chdir=function(o){throw new Error("process.chdir is not supported")},k.umask=function(){return 0}},function(o,i,s){function e(o,i){for(var s=0;s<i.length;s++){var u=i[s];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(o,u.key,u)}}var u=s(9);o.exports=function(){function d(){(function(o,i){if(!(o instanceof i))throw new TypeError("Cannot call a class as a function")})(this,d)}var o,i,s;return o=d,s=[{key:"urlEncode",value:function(o){return u(o)}},{key:"jsonEncode",value:function(o){return JSON.stringify(o)}},{key:"formEncode",value:function(o){if(this.isFormData(o))return o;if(this.isFormElement(o))return new FormData(o);if(this.isObject(o)){var i=new FormData;return Object.keys(o).forEach((function(s){var u=o[s];i.append(s,u)})),i}throw new Error("`data` must be an instance of Object, FormData or <FORM> HTMLElement")}},{key:"isObject",value:function(o){return Object.prototype.toString.call(o)==="[object Object]"}},{key:"isFormData",value:function(o){return o instanceof FormData}},{key:"isFormElement",value:function(o){return o instanceof HTMLFormElement}},{key:"selectFiles",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new Promise((function(i,s){var u=document.createElement("INPUT");u.type="file",o.multiple&&u.setAttribute("multiple","multiple"),o.accept&&u.setAttribute("accept",o.accept),u.style.display="none",document.body.appendChild(u),u.addEventListener("change",(function(o){var s=o.target.files;i(s),document.body.removeChild(u)}),!1),u.click()}))}},{key:"parseHeaders",value:function(o){var i=o.trim().split(/[\r\n]+/),s={};return i.forEach((function(o){var i=o.split(": "),u=i.shift(),k=i.join(": ");u&&(s[u]=k)})),s}}],(i=null)&&e(o.prototype,i),s&&e(o,s),d}()},function(o,i){var r=function(o){return encodeURIComponent(o).replace(/[!'()*]/g,escape).replace(/%20/g,"+")},e=function(o,i,s,u){return i=i||null,s=s||"&",u=u||null,o?function(o){for(var i=new Array,s=0;s<o.length;s++)o[s]&&i.push(o[s]);return i}(Object.keys(o).map((function(k){var _,C,E=k;if(u&&(E=u+"["+E+"]"),typeof o[k]=="object"&&o[k]!==null)_=e(o[k],null,s,E);else{i&&(C=E,E=!isNaN(parseFloat(C))&&isFinite(C)?i+Number(E):E);var T=o[k];T=(T=(T=(T=T===!0?"1":T)===!1?"0":T)===0?"0":T)||"",_=r(E)+"="+r(T)}return _}))).join(s).replace(/[!'()*]/g,""):""};o.exports=e}])}))})(C);var E=C.exports;const T=D(E);function O(o){return o!==void 0&&typeof o.then=="function"}class A{
/**
   * @param params - uploader module params
   * @param params.config - image tool config
   * @param params.onUpload - one callback for all uploading (file, url, d-n-d, pasting)
   * @param params.onError - callback for uploading errors
   */
constructor({config:o,onUpload:i,onError:s}){this.config=o,this.onUpload=i,this.onError=s
/**
   * Handle clicks on the upload file button
   * Fires ajax.transport()
   * @param onPreview - callback fired when preview is ready
   */}uploadSelectedFile({onPreview:o}){const a=function(i){const s=new FileReader;s.readAsDataURL(i),s.onload=i=>{o(i.target.result)}};let i;if(this.config.uploader&&typeof this.config.uploader.uploadByFile=="function"){const o=this.config.uploader.uploadByFile;i=T.selectFiles({accept:this.config.types??"image/*"}).then((i=>{a(i[0]);const s=o(i[0]);return O(s)||console.warn("Custom uploader method uploadByFile should return a Promise"),s}))}else i=T.transport({url:this.config.endpoints.byFile,data:this.config.additionalRequestData,accept:this.config.types??"image/*",headers:this.config.additionalRequestHeaders,beforeSend:o=>{a(o[0])},fieldName:this.config.field??"image"}).then((o=>o.body));i.then((o=>{this.onUpload(o)})).catch((o=>{this.onError(o)}))}
/**
   * Handle clicks on the upload file button
   * Fires ajax.post()
   * @param url - image source url
   */uploadByUrl(o){let i;this.config.uploader&&typeof this.config.uploader.uploadByUrl=="function"?(i=this.config.uploader.uploadByUrl(o),O(i)||console.warn("Custom uploader method uploadByUrl should return a Promise")):i=T.post({url:this.config.endpoints.byUrl,data:Object.assign({url:o},this.config.additionalRequestData),type:T.contentType.JSON,headers:this.config.additionalRequestHeaders}).then((o=>o.body)),i.then((o=>{this.onUpload(o)})).catch((o=>{this.onError(o)}))
/**
   * Handle clicks on the upload file button
   * Fires ajax.post()
   * @param file - file pasted by drag-n-drop
   * @param onPreview - file pasted by drag-n-drop
   */}uploadByFile(o,{onPreview:i}){const s=new FileReader;s.readAsDataURL(o),s.onload=o=>{i(o.target.result)};let u;if(this.config.uploader&&typeof this.config.uploader.uploadByFile=="function")u=this.config.uploader.uploadByFile(o),O(u)||console.warn("Custom uploader method uploadByFile should return a Promise");else{const i=new FormData;i.append(this.config.field??"image",o),this.config.additionalRequestData&&Object.keys(this.config.additionalRequestData).length&&Object.entries(this.config.additionalRequestData).forEach((([o,s])=>{i.append(o,s)})),u=T.post({url:this.config.endpoints.byFile,data:i,type:T.contentType.JSON,headers:this.config.additionalRequestHeaders}).then((o=>o.body))}u.then((o=>{this.onUpload(o)})).catch((o=>{this.onError(o)}))}}
/**
 * Image Tool for the Editor.js
 * @author CodeX <team@codex.so>
 * @license MIT
 * @see {@link https://github.com/editor-js/image}
 *
 * To developers.
 * To simplify Tool structure, we split it to 4 parts:
 *  1) index.ts — main Tool's interface, public API and methods for working with data
 *  2) uploader.ts — module that has methods for sending files via AJAX: from device, by URL or File pasting
 *  3) ui.ts — module for UI manipulations: render, showing preloader, etc
 *
 * For debug purposes there is a testing server
 * that can save uploaded files and return a Response {@link UploadResponseFormat}
 *
 *       $ node dev/server.js
 *
 * It will expose 8008 port, so you can pass http://localhost:8008 with the Tools config:
 *
 * image: {
 *   class: ImageTool,
 *   config: {
 *     endpoints: {
 *       byFile: 'http://localhost:8008/uploadFile',
 *       byUrl: 'http://localhost:8008/fetchUrl',
 *     }
 *   },
 * },
 */class P{
/**
   * @param tool - tool properties got from editor.js
   * @param tool.data - previously saved data
   * @param tool.config - user config for Tool
   * @param tool.api - Editor.js API
   * @param tool.readOnly - read-only mode flag
   * @param tool.block - current Block API
   */
constructor({data:o,config:i,api:s,readOnly:u,block:k}){this.api=s,this.block=k,this.config={endpoints:i.endpoints,additionalRequestData:i.additionalRequestData,additionalRequestHeaders:i.additionalRequestHeaders,field:i.field,types:i.types,captionPlaceholder:this.api.i18n.t(i.captionPlaceholder??"Caption"),buttonContent:i.buttonContent,uploader:i.uploader,actions:i.actions,features:i.features||{}},this.uploader=new A({config:this.config,onUpload:o=>this.onUpload(o),onError:o=>this.uploadingFailed(o)}),this.ui=new U({api:s,config:this.config,onSelectFile:()=>{this.uploader.uploadSelectedFile({onPreview:o=>{this.ui.showPreloader(o)}})},readOnly:u}),this._data={caption:"",withBorder:!1,withBackground:!1,stretched:!1,file:{url:""}},this.data=o}static get isReadOnlySupported(){return!0}static get toolbox(){return{icon:s,title:"Image"}}static get tunes(){return[{name:"withBorder",icon:i,title:"With border",toggle:!0},{name:"stretched",icon:u,title:"Stretch image",toggle:!0},{name:"withBackground",icon:o,title:"With background",toggle:!0}]}render(){var o,i,s;return(((o=this.config.features)==null?void 0:o.caption)===!0||((i=this.config.features)==null?void 0:i.caption)===void 0||((s=this.config.features)==null?void 0:s.caption)==="optional"&&this.data.caption)&&this.ui.applyTune("caption",!0),this.ui.render(this.data)
/**
   * Validate data: check if Image exists
   * @param savedData — data received after saving
   * @returns false if saved data is not correct, otherwise true
   */}validate(o){return!!o.file.url}save(){const o=this.ui.nodes.caption;return this._data.caption=o.innerHTML,this.data
/**
   * Returns configuration for block tunes: add background, add border, stretch image
   * @returns TunesMenuConfig
   */}renderSettings(){var o;const i=P.tunes.concat(this.config.actions||[]),s={border:"withBorder",background:"withBackground",stretch:"stretched",caption:"caption"};return((o=this.config.features)==null?void 0:o.caption)==="optional"&&i.push({name:"caption",icon:k,title:"With caption",toggle:!0}),i.filter((o=>{var i,u;const k=Object.keys(s).find((i=>s[i]===o.name));return k==="caption"?((i=this.config.features)==null?void 0:i.caption)!==!1:k==null||((u=this.config.features)==null?void 0:u[k])!==!1})).map((o=>({icon:o.icon,label:this.api.i18n.t(o.title),name:o.name,toggle:o.toggle,isActive:this.data[o.name],onActivate:()=>{typeof o.action!="function"?this.tuneToggled(o.name):o.action(o.name)}})))}appendCallback(){this.ui.nodes.fileButton.click()}static get pasteConfig(){return{tags:[{img:{src:!0}}],patterns:{image:/https?:\/\/\S+\.(gif|jpe?g|tiff|png|svg|webp)(\?[a-z0-9=]*)?$/i},files:{mimeTypes:["image/*"]}}}
/**
   * Specify paste handlers
   * @see {@link https://github.com/codex-team/editor.js/blob/master/docs/tools.md#paste-handling}
   * @param event - editor.js custom paste event
   *                              {@link https://github.com/codex-team/editor.js/blob/master/types/tools/paste-events.d.ts}
   */async onPaste(o){switch(o.type){case"tag":{const i=o.detail.data;if(/^blob:/.test(i.src)){const o=await(await fetch(i.src)).blob();this.uploadFile(o);break}this.uploadUrl(i.src);break}case"pattern":{const i=o.detail.data;this.uploadUrl(i);break}case"file":{const i=o.detail.file;this.uploadFile(i);break}}}
/**
   * Stores all Tool's data
   * @param data - data in Image Tool format
   */set data(o){this.image=o.file,this._data.caption=o.caption||"",this.ui.fillCaption(this._data.caption),P.tunes.forEach((({name:i})=>{const s=typeof o[i]<"u"&&(o[i]===!0||o[i]==="true");this.setTune(i,s)}))}get data(){return this._data}
/**
   * Set new image file
   * @param file - uploaded file data
   */set image(o){this._data.file=o||{url:""},o&&o.url&&this.ui.fillImage(o.url)
/**
   * File uploading callback
   * @param response - uploading server response
   */}onUpload(o){o.success&&o.file?this.image=o.file:this.uploadingFailed("incorrect response: "+JSON.stringify(o))}
/**
   * Handle uploader errors
   * @param errorText - uploading error info
   */uploadingFailed(o){console.log("Image Tool: uploading failed because of",o),this.api.notifier.show({message:this.api.i18n.t("Couldn’t upload image. Please try another."),style:"error"}),this.ui.hidePreloader()
/**
   * Callback fired when Block Tune is activated
   * @param tuneName - tune that has been clicked
   */}tuneToggled(o){this.setTune(o,!this._data[o]),o==="caption"&&!this._data[o]&&(this._data.caption="",this.ui.fillCaption("")
/**
   * Set one tune
   * @param tuneName - {@link Tunes.tunes}
   * @param value - tune state
   */)}setTune(o,i){this._data[o]=i,this.ui.applyTune(o,i),o==="stretched"&&Promise.resolve().then((()=>{this.block.stretched=i})).catch((o=>{console.error(o)}))
/**
   * Show preloader and upload image file
   * @param file - file that is currently uploading (from paste)
   */}uploadFile(o){this.uploader.uploadByFile(o,{onPreview:o=>{this.ui.showPreloader(o)}})}
/**
   * Show preloader and upload image by target url
   * @param url - url pasted
   */uploadUrl(o){this.ui.showPreloader(o),this.uploader.uploadByUrl(o)}}export{P as default};

