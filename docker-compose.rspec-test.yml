name: skyceer_rspec_test
services:
  web:
    command: bash -c "sleep 5 && rm -f tmp/pids/server.pid && bundle exec rails db:create db:migrate && bundle exec rails assets:precompile && bundle exec rspec"
    environment:
      RAILS_ENV: test
    volumes: !reset null
    depends_on: !reset
      - postgres
      - mongo
      - opensearch

  job:
    command: bash -c "sleep 10 && bundle exec rails db:prepare && bin/jobs"
    environment:
      RAILS_ENV: test
    volumes:
      - .:/rails
    depends_on:
      - web

  postgres:
    volumes: !reset null

  mongo:
    volumes: !reset null

  opensearch:
    volumes: !reset null

  opensearch_dashboards: !reset null

  grafana: !reset null
  
  minio: !reset null

  create_buckets: !reset null